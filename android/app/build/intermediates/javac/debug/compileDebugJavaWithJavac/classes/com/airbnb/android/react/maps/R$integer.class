'use strict';

var keys = require('object-keys');
var forEach = require('foreach');
var indexOf = require('array.prototype.indexof');
var has = require('has');

module.exports = function diffOperations(actual, expected, expectedMissing) {
	var actualKeys = keys(actual);
	var expectedKeys = keys(expected);

	var extra = [];
	var missing = [];
	var extraMissing = [];

	forEach(actualKeys, function (op) {
		if (!(op in expected)) {
			if (actual[op] && typeof actual[op] === 'object') {
				forEach(keys(actual[op]), function (nestedOp) {
					var fullNestedOp = op + '::' + nestedOp;
					if (!(fullNestedOp in expected)) {
						extra.push(fullNestedOp);
					} else if (indexOf(expectedMissing, fullNestedOp) !== -1) {
						extra.push(fullNestedOp);
					}
				});
			} else {
				extra.push(op);
			}
		} else if (i